<!DOCTYPE html>
<html>

<head>
    <title>Real-time Dictation App</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
    <script src="https://code.jquery.com/jquery-3.5.0.js"></script>
    <style>
        body {
            margin: 0;
            font-family: sans-serif;
        }

        form {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            display: flex;
            box-sizing: border-box;
            padding: 0.25rem;
        }

        form input {
            border: 0;
            padding: 0.5rem;
            width: 100%;
            outline: 0;
            margin-right: 0.5rem;
            border-radius: 0.25rem;
            background: #ccc;
        }

        form button {
            width: 6rem;
            background-color: #1b8c00;
            color: white;
            border: none;
            padding: 0.5rem;
            cursor: pointer;
            border-radius: 0.25rem;
            text-transform: uppercase;
            margin: 10px;
        }

        form button:hover {
            background-color: #166d01;
        }

        .messages {
            margin: 0;
            padding: 0;
            margin-bottom: 3rem;
        }

        .messages li {
            padding: 0.5rem;
        }

        .messages li:nth-child(odd) {
            background: #eee;
        }
    </style>
</head>

<body>
    <ul class="messages"></ul>
    <form>
        <select id="voice"></select>
        <button id='nextBtn'>Next word</button>
        <input type="text" class="input" autocomplete="off" autofocus />
        <button id='repeatBtn'>Repeat</button>
        <button id='sendBtn'>Send</button>
    </form>
    <script>
        const form = document.querySelector("form");
        const input = document.querySelector(".input");
        const messages = document.querySelector(".messages");
        const nextBtn = document.querySelector("#nextBtn");
        const sendBtn = document.querySelector("#sendBtn");
        const repeatBtn = document.querySelector("#repeatBtn");
        const voiceSel = document.querySelector("#voice");
        var voices = [];
        const ssu = new SpeechSynthesisUtterance()

        let score = 0,
            total = 0;

        window.speechSynthesis.onvoiceschanged = function () {
            voices = window.speechSynthesis.getVoices();
            voiceSel.options.length = 0;
            voices.forEach(v => {
                console.log(JSON.stringify(v))
                voiceSel.options[voiceSel.options.length] = new Option(v.name + ' (' + v.lang + ')', voiceSel.options.length)
            });
        };

        $('html').bind('keypress', function (e) {
            if (e.keyCode == 13) {
                return false;
            }
        });

        $.get('words.txt', function (data) {
            words = data.split("\n");
        });

        nextBtn.addEventListener("click", function (event) {
            event.preventDefault();
            speakNextWord();
            input.focus();
        }, false);

        repeatBtn.addEventListener("click", function (event) {
            event.preventDefault();
            repeatWord();
            input.focus();
        }, false);

        sendBtn.addEventListener("click", function (event) {
            event.preventDefault();
            evaluate();
            input.focus();
        }, false);

        function evaluate() {
            total++;
            const nextWord = window.sessionStorage.getItem("nextWord").trim().toLowerCase();
            const word = input.value.trim().toLowerCase();
            input.value = "";
            const status = word === nextWord ? 'RIGHT' : 'WRONG';
            if (status == 'RIGHT') score++;
            addMessage(word + ' [' + nextWord + '] : ' + score + '/' + total, status);
            return false;
        }

        function addMessage(message, status) {
            const li = document.createElement("li");
            li.style.color = "red";
            if (status === 'RIGHT')
                li.style.color = "green";
            li.innerHTML = message;
            messages.appendChild(li);
            li.scrollIntoView();
        }

        function repeatWord() {
            event.preventDefault();
            const word = window.sessionStorage.getItem("nextWord").trim().toLowerCase();
            speak(word);
            return false;
        }

        function speakNextWord() {
            event.preventDefault();
            let next = Math.floor((Math.random() * words.length));
            const nextWord = words.splice(next, next)[0];
            speak(nextWord);
            window.sessionStorage.setItem("nextWord", nextWord);
            return false;
        }

        function speak(text) {
            ssu.text = text;
            ssu.voice = voices[voiceSel.selectedIndex];
            window.speechSynthesis.speak(ssu);
        }
    </script>
</body>

</html>